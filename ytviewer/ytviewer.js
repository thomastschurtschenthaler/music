!async function(){if(window.YTViewer_Player=function(){let e=document.createElement("div");e.style.position="fixed",e.style.top="0px",e.style.left="0px",e.style.width="auto",e.style.height="auto",e.style.zIndex="10000",e.style.backgroundColor="rgba(0, 0, 0, 0.3)";let t=document.createElement("div");t.style.position="absolute",t.style.top="10px",t.style.left="10px",t.style.width="8rem",t.style.height="1.8rem",t.style.fontSize="1.5rem",t.style.backgroundColor="#33aa33",t.style.color="#eeeeee",t.style.paddingLeft="1rem",t.style.cursor="pointer",t.style.borderRadius="1rem",t.innerHTML="YTViewer",t.addEventListener("click",(e=>{if(window.location.href.indexOf("?")>=0){let e=new URLSearchParams(window.location.href.substring(window.location.href.lastIndexOf("?")+1)).get("v");if(null!=e)return void window._ytviewer.play(e)}alert("YTViewer - click on a youtube thumbnail to play the video.\n\nAuthor: Thomas Tschurtschenthaler")})),e.appendChild(t),document.body.appendChild(e);let l=null,i=null,o=null,r=null,n=()=>{null!=l&&(e.removeChild(l),e.removeChild(i),e.style.width="auto",e.style.height="auto",t.style.display="inline",r.destroy(),l=null,i=null,o=null,r=null)};return{isplaying:e=>e==o,play:async(s,a)=>{if(n(),null==a){let t=null;try{t=await ytdl.getInfo(s,{})}catch(t){return void(e.innerHTML="Error:"+t)}let l=(e,t)=>t.bitrate-e.bitrate;t.formats=t.formats.sort(l);let i=t.formats.filter((e=>!e.isHLS&&e.hasAudio&&!e.hasVideo)),o=t.formats.filter((e=>e.hasAudio&&e.hasVideo)),r=o.length>0?o[0]:null,n=[],d=t.formats.filter((e=>(!window.MediaSource||!e.isHLS)&&e.hasVideo&&(window.MediaSource||e.hasAudio))).filter((e=>n.indexOf(e.qualityLabel)<0&&(null==r||e==r||e.qualityLabel!=r.qualityLabel)&&(n.push(e.qualityLabel),!0)));a={ytinfo:t,formats:t.formats.filter((e=>!e.isHLS||!0)),audio:i.length>0?i[0]:null,video:d,quality:0,audiovideo:r},console.log("videoinfos",a)}o=s,e.style.width="100%",e.style.height="100%",t.style.display="none",l=document.createElement("video"),l.setAttribute("controls","true"),l.setAttribute("tabindex","0"),l.setAttribute("width","80%"),l.setAttribute("height","80%"),l.style.marginLeft="10%",l.style.marginTop="5%",e.appendChild(l),l.focus(),r=new YTMSEPlayer(l),r.play(a),i=document.createElement("div"),i.style.position="absolute",i.style.top="10px",i.style.left="10px",i.style.width="10rem",i.style.height="1.8rem",e.appendChild(i);let d=document.createElement("div");d.style.position="absolute",d.style.top="0px",d.style.left="0px",d.style.width="2.4rem",d.style.height="1.8rem",d.style.fontSize="1.5rem",d.style.backgroundColor="#aa3333",d.style.color="#eeeeee",d.style.cursor="pointer",d.style.borderRadius="1rem",d.innerHTML="<div style='position:relative; left:0.8rem; top:-0.1rem'>x</div>",d.setAttribute("title","Close"),d.addEventListener("click",(e=>{n()})),i.appendChild(d);let y=document.createElement("div");y.style.position="absolute",y.style.top="0px",y.style.left="3rem",y.style.width="2.4rem",y.style.height="1.8rem",y.style.fontSize="1.5rem",y.style.backgroundColor="#aa8822",y.style.color="#eeeeee",y.style.cursor="pointer",y.style.borderRadius="1rem",y.setAttribute("title","Minimize");let u="<div style='position:relative; left:0.6rem'>—</div>";y.innerHTML=u;let h=!1;if(y.addEventListener("click",(t=>{h?(y.innerHTML=u,e.style.width="100%",e.style.height="100%",l.style.display="inline"):(y.innerHTML="<div style='position:relative; left:0.4rem; top:-0.2rem;'>＋</div>",e.style.width="auto",e.style.height="auto",l.style.display="none"),h=!h})),i.appendChild(y),null!=a&&a.formats.length>0){let e=document.createElement("div");e.style.position="absolute",e.style.top="0px",e.style.left="19rem",e.style.width="2.4rem",e.style.height="1.8rem",e.style.fontSize="1.4rem",e.style.backgroundColor="#8822aa",e.style.color="#eeeeee",e.style.cursor="pointer",e.style.borderRadius="1rem",e.setAttribute("title","Download"),e.innerHTML="<div style='position:relative; left:0.8rem; top:-0.1rem'>↧</div>",e.addEventListener("click",(t=>{let l=[],o=a.formats.filter((e=>e.hasAudio&&e.hasVideo)),r=a.formats.filter((e=>e.hasVideo)),n=a.formats.filter((e=>e.hasAudio&&!e.hasVideo));o.length>0&&(o[0]._dltitle="_Video_and_Audio",l.push(o[0])),r.length>0&&(r[0]._dltitle="_Video",l.push(r[0])),n.length>0&&(n[0]._dltitle="_Audio",l.push(n[0])),e.innerHTML="",l.forEach((t=>{let l=document.createElement("a");l.innerHTML=a.ytinfo.videoDetails.title+t._dltitle+".mp4",l.href=t.url,l.style.display="block",l.download=a.ytinfo.videoDetails.title+t._dltitle+".mp4",l.style.color="#eeeeee",l.style.fontSize="1rem",l.style.marginBottom="0.4rem",l.style.marginTop="0.4rem",l.style.marginLeft="0.4rem",l.style.marginRight="0.4rem",e.appendChild(l),e.style.width="auto",e.style.height="auto",i.style.width="100rem"}))})),i.appendChild(e)}let c=document.createElement("select");c.style.position="absolute",c.style.top="0px",c.style.left="8rem",c.style.width="9rem",c.style.height="1.8rem",c.style.fontSize="1.3rem",c.style.backgroundColor="#2288aa",c.style.color="#eeeeee",c.style.cursor="pointer",c.style.borderRadius="1rem",c.style.border="0";for(let e=0;e<a.video.length;e++){let t=a.video[e],l=document.createElement("option");l.setAttribute("value",e+""),l.innerText=t.qualityLabel,c.appendChild(l)}c.addEventListener("change",(e=>{a.quality=1*c.value;let t=l.currentTime;r.destroy(),r.play(a,t),l.focus()})),i.appendChild(c)}}},window.location.host.indexOf("youtube.com")<0)alert("Use YTViewer on Youtube pages www.youtube.com or m.youtube.com.");else{if(null==window._ytviewer){let e=document.createElement("style");e.innerText="video:focus, select:focus {outline: none;}",document.body.appendChild(e),null!=document.body&&document.body.addEventListener("click",(async e=>{if(e.target.closest('a[href^="/watch?"]')||e.target.closest("ytd-thumbnail")){let t=e.target.closest('a[href^="/watch?"]').href;console.log("videoLink",t);let l=new URLSearchParams(t.substring(t.lastIndexOf("?")+1)).get("v");if(console.log("videoid",l),window._ytviewer.isplaying(l))return;e.preventDefault(),e.stopPropagation(),window._ytviewer.play(l)}}),!0),window._ytviewer=window.YTViewer_Player(),console.log("ytviewer started")}if(window.location.href.indexOf("?")>=0){let e=new URLSearchParams(window.location.href.substring(window.location.href.lastIndexOf("?")+1)).get("v");null!=e&&window._ytviewer.play(e)}}}();